{"version":3,"file":"package-starter.js","sources":["../../../Client/src/modals/manifest.ts","../../../Client/src/modals/modal-token.ts","../../../Client/src/entityactions/member.entity.action.ts","../../../Client/src/entityactions/manifest.ts","../../../Client/src/bundle.manifests.ts"],"sourcesContent":["\nconst modals = [\n  {\n    type: 'modal',\n    alias: 'member.custom.modal',\n    name: 'Member custom modal',\n    js: () => import('./modal-element.js')\n  }\n];\n\nexport const manifests = [...modals];\n","import { UmbModalToken } from \"@umbraco-cms/backoffice/modal\";\n\nexport interface MemberCustomModalData {\n  headline: string;\n  content: string;\n}\n\nexport interface MemberCustomModalValue {\n  content: string\n}\n\nexport const MEMBER_CUSTOM_MODAL = new UmbModalToken<MemberCustomModalData, MemberCustomModalValue>(\n  \"member.custom.modal\",\n  {\n    modal: {\n      type: 'sidebar',\n      size: 'medium'\n    }\n  }\n);\n","import { UmbControllerHostElement } from \"@umbraco-cms/backoffice/controller-api\";\nimport { UmbEntityActionArgs, UmbEntityActionBase } from \"@umbraco-cms/backoffice/entity-action\";\nimport { UMB_MODAL_MANAGER_CONTEXT, UmbModalManagerContext } from \"@umbraco-cms/backoffice/modal\";\nimport { MEMBER_CUSTOM_MODAL } from \"../modals/modal-token.ts\";\nimport { UmbMemberDetailRepository  } from '@umbraco-cms/backoffice/member';\nimport {UMB_AUTH_CONTEXT} from \"@umbraco-cms/backoffice/auth\";\n\nexport class ImpersonateMember extends UmbEntityActionBase<UmbMemberDetailRepository> {\n  #modalManagerContext?: UmbModalManagerContext;\n  private OpenAPIToken: any;\n  constructor(host: UmbControllerHostElement, args: UmbEntityActionArgs<UmbMemberDetailRepository>)\n  {\n    super(host, args)\n    // Fetch/consume the contexts & assign to the private fields\n    this.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => {\n      this.#modalManagerContext = instance;\n    });\n    this.consumeContext(UMB_AUTH_CONTEXT, (_auth) => {\n      const umbOpenApi = _auth.getOpenApiConfiguration();\n      this.OpenAPIToken = umbOpenApi.token;\n    });\n  }\n\n  async execute() {\n    const modal = this.#modalManagerContext?.open(this, MEMBER_CUSTOM_MODAL, {\n      data: {\n        headline:'Impersonate',\n        content: 'Do you want to impersonate this user?',\n      }\n    });\n\n    await modal?.onSubmit().then(async () => {\n      const tokenPromise = (this.OpenAPIToken as any as () => Promise<string>);\n      const token = await tokenPromise();\n\n      const headers: Headers = new Headers()\n      headers.set('Content-Type', 'application/json')\n      headers.set('Accept', 'application/json')\n      headers.set('Authorization', 'Bearer ' + token)\n      const request: RequestInfo = new Request('/umbraco/backoffice/impersonation/v1/impersonate/' + this.args.unique?.toString(), {\n        method: 'GET',\n        headers: headers,\n      })\n      return fetch(request)\n        .then(res => {\n          if (res.ok) {\n            window.location.href = '/';\n          }\n        })\n    }).catch(() => {\n      return;\n    });\n  }\n}\n","//import the entity type for Member\r\nimport { UMB_MEMBER_ENTITY_TYPE } from \"@umbraco-cms/backoffice/member\";\r\n//import our entity action definition\r\nimport { ImpersonateMember } from \"./member.entity.action\";\r\n\r\nconst entityAction = {\r\n  type: 'entityAction',\r\n  kind: 'default',\r\n  alias: 'member.entity.action',\r\n  name: 'member action',\r\n  weight: -1,\r\n  forEntityTypes: [\r\n    UMB_MEMBER_ENTITY_TYPE\r\n  ],\r\n  api: ImpersonateMember,\r\n  meta: {\r\n    icon: 'icon-operator',\r\n    label: 'Impersonate Member',\r\n  },\r\n  conditions: [{\r\n    alias: \"Umb.Condition.SectionAlias\",\r\n    match: \"Umb.Section.Members\"\r\n  }]\r\n}\r\n\r\nexport const manifests = [entityAction];\r\n","import { manifests as modals } from \"./modals/manifest.js\";\r\nimport { manifests as entityActions } from \"./entityactions/manifest.js\";\r\n\r\n// Job of the bundle is to collate all the manifests from different parts of the extension and load other manifests\r\n// We load this bundle from umbraco-package.json\r\nexport const manifests: Array<UmbExtensionManifest> = [\r\n  ...modals,\r\n  ...entityActions\r\n];\r\n"],"names":["modals","manifests","MEMBER_CUSTOM_MODAL","UmbModalToken","ImpersonateMember","UmbEntityActionBase","host","args","__privateAdd","_modalManagerContext","UMB_MODAL_MANAGER_CONTEXT","instance","__privateSet","UMB_AUTH_CONTEXT","_auth","umbOpenApi","modal","_a","__privateGet","tokenPromise","token","headers","request","res","entityAction","UMB_MEMBER_ENTITY_TYPE","entityActions"],"mappings":";;;;;;;;;AACA,MAAMA,IAAS;AAAA,EACb;AAAA,IACE,MAAM;AAAA,IACN,OAAO;AAAA,IACP,MAAM;AAAA,IACN,IAAI,MAAM,OAAO,6BAAoB;AAAA,EAAA;AAEzC,GAEaC,IAAY,CAAC,GAAGD,CAAM,GCCtBE,IAAsB,IAAIC;AAAA,EACrC;AAAA,EACA;AAAA,IACE,OAAO;AAAA,MACL,MAAM;AAAA,MACN,MAAM;AAAA,IAAA;AAAA,EACR;AAEJ;;ACZO,MAAMC,UAA0BC,EAA+C;AAAA,EAGpF,YAAYC,GAAgCC,GAC5C;AACE,UAAMD,GAAMC,CAAI;AAJlB,IAAAC,EAAA,MAAAC;AAME,SAAK,eAAeC,GAA2B,CAACC,MAAa;AAC3D,MAAAC,EAAA,MAAKH,GAAuBE;AAAA,IAAA,CAC7B,GACD,KAAK,eAAeE,GAAkB,CAACC,MAAU;AAC/C,YAAMC,IAAaD,EAAM,wBAAA;AACzB,WAAK,eAAeC,EAAW;AAAA,IAAA,CAChC;AAAA,EAAA;AAAA,EAGH,MAAM,UAAU;;AACd,UAAMC,KAAQC,IAAAC,EAAA,MAAKT,OAAL,gBAAAQ,EAA2B,KAAK,MAAMf,GAAqB;AAAA,MACvE,MAAM;AAAA,QACJ,UAAS;AAAA,QACT,SAAS;AAAA,MAAA;AAAA,IACX;AAGF,WAAMc,KAAA,gBAAAA,EAAO,WAAW,KAAK,YAAY;;AACvC,YAAMG,IAAgB,KAAK,cACrBC,IAAQ,MAAMD,EAAA,GAEdE,IAAmB,IAAI,QAAA;AAC7B,MAAAA,EAAQ,IAAI,gBAAgB,kBAAkB,GAC9CA,EAAQ,IAAI,UAAU,kBAAkB,GACxCA,EAAQ,IAAI,iBAAiB,YAAYD,CAAK;AAC9C,YAAME,IAAuB,IAAI,QAAQ,wDAAsDL,IAAA,KAAK,KAAK,WAAV,gBAAAA,EAAkB,aAAY;AAAA,QAC3H,QAAQ;AAAA,QACR,SAAAI;AAAA,MAAA,CACD;AACD,aAAO,MAAMC,CAAO,EACjB,KAAK,CAAAC,MAAO;AACX,QAAIA,EAAI,OACN,OAAO,SAAS,OAAO;AAAA,MACzB,CACD;AAAA,IAAA,GACF,MAAM,MAAM;AAAA,IACb;AAAA,EACD;AAEL;AA7CEd,IAAA;ACHF,MAAMe,IAAe;AAAA,EACnB,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AAAA,EACP,MAAM;AAAA,EACN,QAAQ;AAAA,EACR,gBAAgB;AAAA,IACdC;AAAA,EAAA;AAAA,EAEF,KAAKrB;AAAA,EACL,MAAM;AAAA,IACJ,MAAM;AAAA,IACN,OAAO;AAAA,EAAA;AAAA,EAET,YAAY,CAAC;AAAA,IACX,OAAO;AAAA,IACP,OAAO;AAAA,EAAA,CACR;AACH,GAEaH,IAAY,CAACuB,CAAY,GCpBzBvB,IAAyC;AAAA,EACpD,GAAGD;AAAAA,EACH,GAAG0B;AACL;"}